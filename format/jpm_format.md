# YMF825-MusicBox Dumpfile (JPM) Format

## バージョン

Ver.1.0

### 互換性

JPM フォーマットは以前の `.825`, `.m25` フォーマットとは互換性がありません。

## 拡張子

`.jpm`

## ヘッダ

ヘッダは 4 バイト。

| +0  | +1  | +2  | +3      |
| --- | --- | --- | ------- |
| `j` | `p` | `m` | Version |

### Version

`0x00`

## チャンク

チャンクヘッダは 1 バイト。

| +0   | +1   | +2   | +3   | +4   | +5   | +6   | +7   |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| WOP0 | WOP1 | SEL0 | SEL1 | LEN0 | LEN1 | LEN2 | LEN3 |

### WOPx

| WOP0 | WOP1 | Operation                     |
| ---- | ---- | ----------------------------- |
| `0`  | `0`  | Write / Wait                  |
| `0`  | `1`  | LCD Operate                   |
| `1`  | `0`  | BurstWrite to tone parameters |
| `1`  | `1`  | BurstWrite to equalizer       |

SELx で Wait を使用する場合は、WOPx は `00` (Write / Wait) でなければならない。

### SELx

#### WOPx が Write / Wait のとき

| SEL0 | SEL1 | Operation          |
| ---- | ---- | ------------------ |
| `0`  | `0`  | Wait               |
| `0`  | `1`  | Only Lch enable    |
| `1`  | `0`  | Only Rch enable    |
| `1`  | `1`  | Lch and Rch enable |

Wait の分解能は 10ms。
デフォルト値は `1` `1` (Lch and Rch enable)。

#### WOPx が LCD Operate のとき

| SEL0 | SEL1 | Operation           |
| ---- | ---- | ------------------- |
| `0`  | `0`  | Write string        |
| `0`  | `1`  | LCD Control         |
| `1`  | `0`  | Set position Line 0 |
| `1`  | `1`  | Set position Line 1 |

#### WOPx が BurstWrite のとき

| SEL0 | SEL1 | Operation          |
| ---- | ---- | ------------------ |
| `0`  | `0`  | (Reserved)         |
| `0`  | `1`  | Only Lch enable    |
| `1`  | `0`  | Only Rch enable    |
| `1`  | `1`  | Lch and Rch enable |

デフォルト値は `1` `1` (Lch and Rch enable)。

### LENx

| WOP0 | WOP1 | SEL0 | SEL1 | LENx の意味                                                |
| ---- | ---- | ---- | ---- | ---------------------------------------------------------- |
| `0`  | `0`  | `0`  | `0`  | Wait 時間。1 ～ 16 ticks                                   |
| `0`  | `0`  | `0`  | `1`  | Address/Data 数。2 〜 32 バイト                            |
| `0`  | `0`  | `1`  | `0`  | Address/Data 数。2 〜 32 バイト                            |
| `0`  | `0`  | `1`  | `1`  | Address/Data 数。2 〜 32 バイト                            |
| `0`  | `1`  | `0`  | `0`  | 文字数。1 〜 16 バイト                                     |
| `0`  | `1`  | `0`  | `1`  | コントロールの内容（下記参照）                             |
| `0`  | `1`  | `1`  | `0`  | カーソル位置。1 〜 16 文字目                               |
| `0`  | `1`  | `1`  | `1`  | カーソル位置。1 〜 16 文字目                               |
| `1`  | `0`  | `0`  | `0`  | (Reserved)                                                 |
| `1`  | `0`  | `0`  | `1`  | 書き込みパート数。1 〜 16 パート、1 + 30 〜 480 + 5 バイト |
| `1`  | `0`  | `1`  | `0`  | 書き込みパート数。1 〜 16 パート、1 + 30 〜 480 + 5 バイト |
| `1`  | `0`  | `1`  | `1`  | 書き込みパート数。1 〜 16 パート、1 + 30 〜 480 + 5 バイト |
| `1`  | `1`  | `0`  | `0`  | (Reserved)                                                 |
| `1`  | `1`  | `0`  | `1`  | LENx の値は無視。1 + 15 バイト固定                         |
| `1`  | `1`  | `1`  | `0`  | LENx の値は無視。1 + 15 バイト固定                         |
| `1`  | `1`  | `1`  | `1`  | LENx の値は無視。1 + 15 バイト固定                         |

#### LCD コントロール

| LEN0 | LEN1 | LEN2 | LEN3 | Operation                     |
| ---- | ---- | ---- | ---- | ----------------------------- |
| `0`  | `0`  | `0`  | `0`  | クリア                        |
| `0`  | `0`  | `0`  | `1`  | 背景色セット。RGB の 3 バイト |
| `0`  | `0`  | `1`  | `0`  | 左へスクロール                |
| `0`  | `0`  | `1`  | `1`  | 右へスクロール                |
| `0`  | `1`  | `0`  | `0`  | カーソル非表示（デフォルト）  |
| `0`  | `1`  | `0`  | `1`  | カーソル表示                  |
| `0`  | `1`  | `1`  | `0`  | 点滅なし（デフォルト）        |
| `0`  | `1`  | `1`  | `1`  | 点滅あり                      |
| `1`  | `0`  | `0`  | `0`  | キャラクタ 0 作成             |
| `1`  | `0`  | `0`  | `1`  | キャラクタ 1 作成             |
| `1`  | `0`  | `1`  | `0`  | キャラクタ 2 作成             |
| `1`  | `0`  | `1`  | `1`  | キャラクタ 3 作成             |
| `1`  | `1`  | `0`  | `0`  | キャラクタ 4 作成             |
| `1`  | `1`  | `0`  | `1`  | キャラクタ 5 作成             |
| `1`  | `1`  | `1`  | `0`  | キャラクタ 6 作成             |
| `1`  | `1`  | `1`  | `1`  | キャラクタ 7 作成             |
